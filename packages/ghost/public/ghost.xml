<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE visualization SYSTEM "../../visualization.dtd">
<visualization name="Ghost" embeddable="true">
    <description>Virtual Webserver for HTML archives</description>
    <data_sources>
        <data_source>
            <model_class>HistoryDatasetAssociation</model_class>
            <test test_attr="ext">qza</test>
            <test test_attr="ext">qzv</test>
        </data_source>
    </data_sources>
    <params>
        <param required="true">dataset_id</param>
    </params>
    <entry_point entry_point_type="script" src="index.js" css="index.css" />
    <tests>
        <test>
            <param name="dataset_id" label="Raincloud Baseline" ftype="qzv" value="https://raw.githubusercontent.com/qiime2/q2-fmt/master/demo/raincloud-baseline0.qzv" />
        </test>
        <test>
            <param name="dataset_id" label="FastTree Empire" ftype="qzv" value="https://raw.githubusercontent.com/caporaso-lab/q2view-visualizations/main/uu-fasttree-empire.qzv" />
        </test>
    </tests>
    <help format="markdown"><![CDATA[
# What is GHOST?

GHOST is a Galaxy visualization for securely displaying interactive websites that are packaged
as QIIME 2 visualization files (`.qzv`) or similar ZIP archives containing an `index.html` file.
These archives often contain JavaScript, and data assets for rich, client-side exploration of analysis results.

When you open a `.qzv` dataset with GHOST:

1. The file is fetched and unzipped in your browser.
2. The `index.html` is located and assets load through a **service worker** at a dedicated scope.
3. The service worker serves only the files from the archive, blocking all other same-origin requests
   (for example, API calls) to prevent malicious content from interacting with Galaxy.

## Key Features

- **Secure Sandbox**: Blocks access to Galaxy APIs from within the visualization.
- **Dynamic Asset Loading**: No need to pre-extract archives on the server.
- **Format Agnostic**: Works with any ZIP that contains a self-contained HTML visualization.

## Security Notes

- Only GET requests within the visualization's virtual scope are served.
- All other same-origin requests are blocked with a `403 Forbidden` response.
- Cross-origin requests are unaffected but subject to normal browser CORS rules.

## When to Use GHOST

GHOST is ideal for:
- Viewing `.qzv` files generated by QIIME 2.
- Displaying any self-contained HTML/JS/CSS visualization from a ZIP.
- Running third-party visualizations in a safe, sandboxed environment inside Galaxy.
    ]]></help>
</visualization>